@page
@using EntraPruefungsApp.Models
@model EntraPruefungsApp.Features.Exams.TakeModel
@{
    ViewData["Title"] = Model.Exam?.Title ?? "Prüfung";
}

@if (Model.Exam == null)
{
    <h1>Prüfung nicht gefunden</h1>
    <a href="/exams" class="btn btn-secondary"><i class="bi bi-arrow-left me-1"></i>Zurück zur Übersicht</a>
}
else if (Model.Completed)
{
    <div class="alert alert-success">
        <h4>Prüfung abgeschlossen</h4>
        <p>Ihre Prüfung wurde erfolgreich abgeschickt und wird vom Prüfer bewertet.</p>
    </div>
    <a href="/exams" class="btn btn-primary"><i class="bi bi-arrow-left me-1"></i>Zurück zur Übersicht</a>
}
else
{
    <h1>@Model.Exam.Title</h1>
    <p>@Model.Exam.Description</p>

    <form method="post">
        <input type="hidden" asp-for="ExamId" />
        
        @for (int i = 0; i < Model.Exam.Questions.Count; i++)
        {
            var question = Model.Exam.Questions[i];
            <div class="card mb-3 border-2" style="border-width: 2px !important;">
                <div class="card-body">
                    <h5 class="card-title">Frage @(i + 1) @(question.Type == QuestionType.FreeText ? $"({question.MaxPoints} Punkte)" : "")</h5>
                    <p class="card-text">@question.Text</p>
                    
                    @if (question.Type == QuestionType.MultipleChoice)
                    {
                        @for (int j = 0; j < question.Answers.Count; j++)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Answers[@Model.GetMCQuestionIndex(i)]" value="@j" id="question@(i)_answer@(j)" />
                                <label class="form-check-label" for="question@(i)_answer@(j)">
                                    @question.Answers[j]
                                </label>
                            </div>
                        }
                    }
                    else if (question.Type == QuestionType.FreeText)
                    {
                        <textarea class="form-control" name="FreeTextAnswers[@Model.GetFreeTextQuestionIndex(i)]" rows="4" placeholder="Ihre Antwort hier eingeben..."></textarea>
                    }
                </div>
            </div>
        }
        
        <button type="submit" class="btn btn-success"><i class="bi bi-check-lg me-1"></i>Prüfung abschließen</button>
        <a href="/exams" class="btn btn-secondary"><i class="bi bi-x-lg me-1"></i>Abbrechen</a>
    </form>
}